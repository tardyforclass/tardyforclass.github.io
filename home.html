<!DOCTYPE html>
<html>
  <head>
	  
	  <link rel="stylesheet" type="text/css" href="addtohomescreen.css">
<script src="addtohomescreen.js"></script>
<script>
addToHomescreen();
</script>
	  
    <title>Carryr</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	   <meta name="apple-mobile-web-app-capable" content="yes">
	 
    <meta charset="utf-8">
    <style>
	    
	    body {
        background-color: #EDEBEB
      }
	    
	   
     
      
      
       .btn {
  -moz-box-shadow: 3px 4px 0px 0px #8a2a21;
  -webkit-box-shadow: 3px 4px 0px 0px #8a2a21;
  box-shadow: 3px 4px 0px 0px #8a2a21;
  background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #c62d1f), color-stop(1, #f24437));
  background:-moz-linear-gradient(top, #c62d1f 5%, #f24437 100%);
  background:-webkit-linear-gradient(top, #c62d1f 5%, #f24437 100%);
  background:-o-linear-gradient(top, #c62d1f 5%, #f24437 100%);
  background:-ms-linear-gradient(top, #c62d1f 5%, #f24437 100%);
  background:linear-gradient(to bottom, #c62d1f 5%, #f24437 100%);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#c62d1f', endColorstr='#f24437',GradientType=0);
  background-color:#c62d1f;
  -moz-border-radius:18px;
  -webkit-border-radius:18px;
  border-radius:18px;
  border:1px solid #d02718;
  display:inline-block;
  cursor:pointer;
  color:#ffffff;
  font-family:Arial;
  font-size:17px;
  padding:7px 25px;
  text-decoration:none;
  text-shadow:0px 1px 0px #810e05;
}
.btn:hover {
  background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #f24437), color-stop(1, #c62d1f));
  background:-moz-linear-gradient(top, #f24437 5%, #c62d1f 100%);
  background:-webkit-linear-gradient(top, #f24437 5%, #c62d1f 100%);
  background:-o-linear-gradient(top, #f24437 5%, #c62d1f 100%);
  background:-ms-linear-gradient(top, #f24437 5%, #c62d1f 100%);
  background:linear-gradient(to bottom, #f24437 5%, #c62d1f 100%);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#f24437', endColorstr='#c62d1f',GradientType=0);
  background-color:#f24437;
}
.btn:active {
  position:relative;
  top:1px;
}
      
.myButton {
  -moz-box-shadow: 3px 4px 0px 0px #8a2121;
  -webkit-box-shadow: 3px 4px 0px 0px #8a2121;
  box-shadow: 3px 4px 0px 0px #8a2121;
  background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #2398c2), color-stop(1, #00bbff));
  background:-moz-linear-gradient(top, #2398c2 5%, #00bbff 100%);
  background:-webkit-linear-gradient(top, #2398c2 5%, #00bbff 100%);
  background:-o-linear-gradient(top, #2398c2 5%, #00bbff 100%);
  background:-ms-linear-gradient(top, #2398c2 5%, #00bbff 100%);
  background:linear-gradient(to bottom, #2398c2 5%, #00bbff 100%);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#2398c2', endColorstr='#00bbff',GradientType=0);
  background-color:#2398c2;
  -moz-border-radius:18px;
  -webkit-border-radius:18px;
  border-radius:18px;
  border:1px solid #00a6ff;
  display:inline-block;
  cursor:pointer;
  color:#ffffff;
  font-family:Arial;
  font-size:17px;
  padding:7px 25px;
  text-decoration:none;
  text-shadow:0px 1px 0px #00bbff;
}
.myButton:hover {
  background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #00bbff), color-stop(1, #2398c2));
  background:-moz-linear-gradient(top, #00bbff 5%, #2398c2 100%);
  background:-webkit-linear-gradient(top, #00bbff 5%, #2398c2 100%);
  background:-o-linear-gradient(top, #00bbff 5%, #2398c2 100%);
  background:-ms-linear-gradient(top, #00bbff 5%, #2398c2 100%);
  background:linear-gradient(to bottom, #00bbff 5%, #2398c2 100%);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#00bbff', endColorstr='#2398c2',GradientType=0);
  background-color:#00bbff;
}
.myButton:active {
  position:relative;
  top:1px;
}
      
      
      
      
      
      
      
      
      
      
      
      .pay {
	-moz-box-shadow: 3px 4px 0px 0px #3dc21b;
	-webkit-box-shadow: 3px 4px 0px 0px #3dc21b;
	box-shadow: 3px 4px 0px 0px #3dc21b;
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #44c767), color-stop(1, #5cbf2a));
	background:-moz-linear-gradient(top, #44c767 5%, #5cbf2a 100%);
	background:-webkit-linear-gradient(top, #44c767 5%, #5cbf2a 100%);
	background:-o-linear-gradient(top, #44c767 5%, #5cbf2a 100%);
	background:-ms-linear-gradient(top, #44c767 5%, #5cbf2a 100%);
	background:linear-gradient(to bottom, #44c767 5%, #5cbf2a 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#44c767', endColorstr='#5cbf2a',GradientType=0);
	background-color:#44c767;
	-moz-border-radius:18px;
	-webkit-border-radius:18px;
	border-radius:18px;
	border:1px solid #27c236;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:17px;
	padding:7px 25px;
	text-decoration:none;
	text-shadow:0px 1px 0px #2f6627;
}
.pay:hover {
	background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #5cbf2a), color-stop(1, #44c767));
	background:-moz-linear-gradient(top, #5cbf2a 5%, #44c767 100%);
	background:-webkit-linear-gradient(top, #5cbf2a 5%, #44c767 100%);
	background:-o-linear-gradient(top, #5cbf2a 5%, #44c767 100%);
	background:-ms-linear-gradient(top, #5cbf2a 5%, #44c767 100%);
	background:linear-gradient(to bottom, #5cbf2a 5%, #44c767 100%);
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#5cbf2a', endColorstr='#44c767',GradientType=0);
	background-color:#5cbf2a;
}
.pay:active {
	position:relative;
	top:1px;
}
.dropbtn {
  background-color: #F60FFE;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}
.dropbtn:hover, .dropbtn:focus {
  background-color: #F60FFE;
}
.dropdown {
  position: relative;
  display: inline-block;
}
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}
.dropdown a:hover {background-color: #ddd;}
.show {display: block;}
#container {
  display: flex;
  flex-direction: row;
  width: 100%;
}
 
#spacer {
  flex: 1;
}
.dropbtn {
  -moz-box-shadow: 3px 4px 0px 0px #8a2a21;
  -webkit-box-shadow: 3px 4px 0px 0px #8a2a21;
  box-shadow: 3px 4px 0px 0px #8a2a21;
  background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #ff00ae), color-stop(1, #ff00f7));
  background:-moz-linear-gradient(top, #ff00ae 5%, #ff00f7 100%);
  background:-webkit-linear-gradient(top, #ff00ae 5%, #ff00f7 100%);
  background:-o-linear-gradient(top, #ff00ae 5%, #ff00f7 100%);
  background:-ms-linear-gradient(top, #ff00ae 5%, #ff00f7 100%);
  background:linear-gradient(to bottom, #ff00ae 5%, #ff00f7 100%);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff00ae', endColorstr='#ff00f7',GradientType=0);
  background-color:#ff00ae;
  -moz-border-radius:18px;
  -webkit-border-radius:18px;
  border-radius:18px;
  border:1px solid #d02718;
  display:inline-block;
  cursor:pointer;
  color:#ffffff;
  font-family:Arial;
  font-size:17px;
  padding:7px 8px;
  text-decoration:none;
  text-shadow:0px 1px 0px #810e05;
}
.dropbtn:hover {
  background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #ff00f7), color-stop(1, #ff00ae));
  background:-moz-linear-gradient(top, #ff00f7 5%, #ff00ae 100%);
  background:-webkit-linear-gradient(top, #ff00f7 5%, #ff00ae 100%);
  background:-o-linear-gradient(top, #ff00f7 5%, #ff00ae 100%);
  background:-ms-linear-gradient(top, #ff00f7 5%, #ff00ae 100%);
  background:linear-gradient(to bottom, #ff00f7 5%, #ff00ae 100%);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff00f7', endColorstr='#ff00ae',GradientType=0);
  background-color:#ff00f7;
}
.dropbtn:active {
  position:relative;
  top:1px;
}
     
      
      
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 80%;
        margin: 0;
        padding: 0;
      }
    </style>
    <!-- Place this inside the H
      TML head; don't use async defer for now -->

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="ptr.js"></script>    
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
<script src="https://cdn.firebase.com/libs/geofire/4.1.2/geofire.min.js"></script>

  <script>
        
        var config = {
    apiKey: "",
    authDomain: "carrier-35d7c.firebaseapp.com",
    databaseURL: "https://carrier-35d7c.firebaseio.com",
    projectId: "carrier-35d7c",
    storageBucket: "carrier-35d7c.appspot.com",
    messagingSenderId: "827792028763"
  };
        if (!firebase.apps.length) {
            firebase.initializeApp(config);
        }
        
        //Create a node at firebase location to add locations as child keys
        //var locationsRef = firebase.database().ref("locations");
        
        // Create a new GeoFire key under users Firebase location
        //var geoFire = new GeoFire(locationsRef.push());
        //Create a node at firebase location to add locations as child keys
        //confirm(firebase.auth().currentUser)
    
    //var a = localStorage.getItem('phoneNumber');
    
 
        var locationsRef = firebase.database().ref("locations");
        var pushRef = locationsRef.push()
        var postID = pushRef.key;
      console.log(postID);
      
      // Create a new GeoFire key under users Firebase location
      // replace var geoFire = new GeoFire(locationsRef.push()); with
      var geoFire = new GeoFire(pushRef); 
      </script>


  </head>
  <body>
    <div id="map"></div>
    <script>
      
    
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      var map, infoWindow;
      var lat, lng;
      function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: -34.397, lng: 150.644 },
        zoom: 18
        //mapTypeId: google.maps.MapTypeId.ROADMAP
      });
      infoWindow = new google.maps.InfoWindow;
      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          lat = position.coords.latitude;
          lng = position.coords.longitude;
          var pos = { lat: lat, lng: lng, name };
          _setGeoFire();
          var locationsRef = firebase.database().ref("locations");
          locationsRef.on('child_added', function (snapshot) {
            var data = snapshot.val();
            //console.log(data, "Prueba memo");
             if (data && data.User && data.User.l) {
              var marker = new google.maps.Marker({
                position: {
                  lat: data.User.l[0],
                  lng: data.User.l[1]
                },
                map: map,
                // new google.maps.Size(42, 68)
              });
              a = localStorage.getItem('phone')
  
  var database = firebase.database();
              var fruitsRef = database.ref('locations/'+ postID + '/User/g');
              fruitsRef.update ({
                number: (a)
              })
              marker.addListener('click', (function (data) {
                return function (e) {
                 var a = document.createElement('a');
                 var linkText = document.createTextNode(data.User.g.number);
                 a.appendChild(linkText);
                 a.title = (data.User.g.number);
                 a.href = "sms://" +  (data.User.g.number);
                  infoWindow.setContent(document.body.appendChild(a));
                  infoWindow.open(map, this);
                }
              }(data)));
            }
          });
          infoWindow.setPosition(pos);
          infoWindow.setContent('Current Location');
          infoWindow.open(map);
          map.setCenter(pos);
        }, function () {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }
      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
     function _setGeoFire(){
geoFire.set("User", [lat, lng] ).then(()=>{
  console.log("Location added");
  
  pushRef.child("User").onDisconnect().remove();
}).catch(function(error) {
  console.log(error);
});
}
    </script>
    
    <script 
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2nPlSt_nM7PSKD8So8anbUbBYICFWcCA&callback=initMap">
    </script>
    <center><button id="MyButton" class="btn btn-warning" style="float: right;" >Load</button></center>

     <center><input type="button" class="myButton" style="float: left;" value="Home" onclick="window.location.href='https://vkprakash.github.io/carryr/reload.html'" /> </center>

  

  <center>  
<div class="dropdown">
  <center><button onclick="myFunction()" class="dropbtn">Marker=Undefined</button></center>
  <div id="myDropdown" class="dropdown-content">
   <p>If you click on a marker and a phone number is not displayed or it's undefined, then click the Load button. If it still doesn't show up, that means another user is currently using that marker</p>
  </div>
</div>
<center>

<script>
/* When the user clicks on the button, 
toggle between hiding and showing the dropdown content */
function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}
// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>

   
<!-- <center><input type="button" class="pay" style="float: center;" value="Pay With Card" onclick="window.location.href='https://pay.google.com/payments/u/0/home#sendRequestMoney'" /> </center> -->
    
    
    
    
      
    <script>
       $("#MyButton").click(function() {
         location.href = "home.html"
   $("#map").load(location.href + " #map>*", "");
  }); 
</script>


    
</body>
